<!DOCTYPE html>
<html>
  <head>
    <title>nostr-req</title>
  </head>
  <body>
    <h1>nostr-req</h1>
    ids:
    <input id="ids" type="text" size="50" placeholder="nevent1... or nostr:nevent1..." /><br />
    author:
    <input id="author" type="text" size="50" placeholder="npub1..." /><br />
    kind:
    <input id="kind" type="text" /><br />
    <button onclick="handleClick()">get</button>
    <button onclick="handleListClick()">list</button><br />
    event:
    <pre id="event"></pre>

    <script src="https://unpkg.com/nostr-tools/lib/nostr.bundle.js"></script>
    <script>
      const $ = document.getElementById.bind(document);

      const RELAYS = [
        "wss://nos.lol",
        "wss://nostr.bitcoiner.social",
        "wss://nostr.mom",
        "wss://relay.damus.io",
        "wss://relay.nostr.bg",
        "wss://relay-jp.nostr.wirednet.jp",
        "wss://r.hostr.cc",
      ];

      const makeFilter = () => {
        const ids = $("ids")
          .value.split(",")
          .filter((value) => value)
          .map(
            (value) =>
              window.NostrTools.nip19.decode(value.replace(/^nostr:/, "")).data
                .id
          );
        const authors = $("author")
          .value.split(",")
          .filter((value) => value)
          .map((value) => window.NostrTools.nip19.decode(value).data);

        return {
          ids: ids.length > 0 ? ids : undefined,
          authors: authors.length > 0 ? authors : undefined,
          kinds: $("kind")
            .value.split(",")
            .map((value) => parseInt(value)),
        };
      };

      const handleClick = async () => {
        const pool = new window.NostrTools.SimplePool();
        const event = await pool.get(RELAYS, makeFilter());
        $("event").innerText = JSON.stringify(event, null, 2);
      };

      const handleListClick = async () => {
        const pool = new window.NostrTools.SimplePool();
        const events = await pool.list(RELAYS, [
          makeFilter(),
        ]);
        $("event").innerText = events
          .map((event) => JSON.stringify(event, null, 2))
          .join("\n");
      };
    </script>
  </body>
</html>
